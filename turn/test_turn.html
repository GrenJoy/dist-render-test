<!DOCTYPE html>
<html>
<head>
    <title>TURN Server Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç TURN —Å–µ—Ä–≤–µ—Ä–∞</h1>
    
    <div>
        <label>TURN Server URL:</label>
        <input type="text" id="turnUrl" value="turn-dist.onrender.com" style="width: 300px;">
    </div>
    <div>
        <label>Username:</label>
        <input type="text" id="username" value="voicechat" style="width: 200px;">
    </div>
    <div>
        <label>Password:</label>
        <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="width: 200px;">
    </div>
    
    <div style="margin: 20px 0;">
        <button onclick="testTurnServer()">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å TURN —Å–µ—Ä–≤–µ—Ä</button>
        <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
    
    <div class="log" id="log">
        <strong>–õ–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>
        –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å TURN —Å–µ—Ä–≤–µ—Ä" –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏...
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '<strong>–õ–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>';
        }

        async function testTurnServer() {
            const turnUrl = document.getElementById('turnUrl').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!password) {
                log('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å!', 'error');
                return;
            }
            
            log('üöÄ –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç TURN —Å–µ—Ä–≤–µ—Ä–∞...');
            log(`üìç URL: ${turnUrl}`);
            log(`üë§ Username: ${username}`);
            log(`üîë Password: ${password ? '***' : '–ù–ï –£–ö–ê–ó–ê–ù'}`);
            
            try {
                // –°–æ–∑–¥–∞–µ–º RTCPeerConnection —Å TURN —Å–µ—Ä–≤–µ—Ä–æ–º
                const configuration = {
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        {
                            urls: `turn:${turnUrl}:3478`,
                            username: username,
                            credential: password
                        }
                    ]
                };
                
                log('üì° –°–æ–∑–¥–∞—é RTCPeerConnection...');
                const pc = new RTCPeerConnection(configuration);
                
                // –°–ª—É—à–∞–µ–º ICE candidates
                pc.onicecandidate = (event) => {
                    if (event.candidate) {
                        log(`üéØ ICE Candidate: ${event.candidate.type} - ${event.candidate.address}`, 'success');
                        
                        if (event.candidate.type === 'relay') {
                            log('‚úÖ TURN —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ–ª—É—á–µ–Ω relay candidate', 'success');
                        }
                    }
                };
                
                pc.oniceconnectionstatechange = () => {
                    log(`üîó ICE Connection State: ${pc.iceConnectionState}`);
                };
                
                pc.onconnectionstatechange = () => {
                    log(`üåê Connection State: ${pc.connectionState}`);
                };
                
                // –°–æ–∑–¥–∞–µ–º offer –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ ICE
                log('üìù –°–æ–∑–¥–∞—é offer...');
                const offer = await pc.createOffer();
                await pc.setLocalDescription(offer);
                
                log('‚è≥ –ñ–¥—É ICE candidates...');
                
                // –ñ–¥–µ–º 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å–±–æ—Ä–∞ ICE candidates
                setTimeout(() => {
                    log('‚è∞ –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ');
                    pc.close();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∏ –ª–∏ relay candidates
                    if (pc.iceConnectionState === 'checking' || pc.iceConnectionState === 'connected') {
                        log('‚úÖ TURN —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!', 'success');
                    } else {
                        log('‚ùå TURN —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ credentials', 'error');
                    }
                }, 10000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
