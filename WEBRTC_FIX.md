# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebRTC Signaling –æ—à–∏–±–æ–∫

## üö® –ü—Ä–æ–±–ª–µ–º–∞
```
InvalidStateError: Failed to execute 'createAnswer' on 'RTCPeerConnection': 
PeerConnection cannot create an answer in a state other than have-remote-offer or have-local-pranswer.

InvalidStateError: Failed to execute 'setRemoteDescription' on 'RTCPeerConnection': 
Failed to set remote answer sdp: Called in wrong state: stable
```

## üîç –ü—Ä–∏—á–∏–Ω–∞
WebRTC PeerConnection –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏:
- `createAnswer` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –Ω–µ—Ç `offer`
- `setRemoteDescription` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `stable` –≤–º–µ—Å—Ç–æ `have-remote-offer`
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å offer/answer

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å Signaling**
- **Initiator** (–ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) —Å–æ–∑–¥–∞–µ—Ç `offer`
- **Receiver** (–≤—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) –ø–æ–ª—É—á–∞–µ—Ç `offer`, —Å–æ–∑–¥–∞–µ—Ç `answer`
- **Initiator** –ø–æ–ª—É—á–∞–µ—Ç `answer` –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç remote description

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è PeerConnection**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `signalingState` –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `connectionState` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `remoteDescription` –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º ICE candidates

### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- Try-catch –±–ª–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö WebRTC –æ–ø–µ—Ä–∞—Ü–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

### 4. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
- –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `peerConnectionState`
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è `onsignalingstatechange`
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è `oniceconnectionstatechange`

### 5. **–°–±—Ä–æ—Å –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**
- –§—É–Ω–∫—Ü–∏—è `resetWebRTC()` –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö WebSocket
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üß™ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
1. –ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∫–æ–º–Ω–∞—Ç—É
2. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: "Creating offer as initiator"
3. –°–æ—Å—Ç–æ—è–Ω–∏–µ WebRTC –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: "have-local-offer"

### –®–∞–≥ 2: –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
1. –í—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç ID –∫–æ–º–Ω–∞—Ç—ã
2. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: "Received offer, setting remote description"
3. –°–æ—Å—Ç–æ—è–Ω–∏–µ WebRTC –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: "have-remote-offer"
4. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: "Creating answer"
5. –°–æ—Å—Ç–æ—è–Ω–∏–µ WebRTC –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: "stable"

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
1. –û–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å: "stable"
2. –í –∫–æ–Ω—Å–æ–ª–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ WebRTC
3. –ì–æ–ª–æ—Å –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã

## üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏:

### –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```
Creating offer as initiator
Signaling state changed: have-local-offer
Received offer, setting remote description
Signaling state changed: have-remote-offer
Creating answer
Signaling state changed: stable
```

### –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫:
- –ù–µ—Ç `InvalidStateError`
- –ù–µ—Ç `Failed to execute` –æ—à–∏–±–æ–∫
- WebRTC —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üö® –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å** –Ω–∞ –Ω–æ–≤—ã–µ –æ—à–∏–±–∫–∏
2. **–£–±–µ–¥–∏—Ç–µ—Å—å**, —á—Ç–æ –æ–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**, —á—Ç–æ backend —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **–û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞** –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É

## üì± –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **–†–∞–∑—Ä–µ—à–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω** –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –±—Ä–∞—É–∑–µ—Ä–∞
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**
4. **–ù–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
